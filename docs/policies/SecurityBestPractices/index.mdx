---
sidebar_position: 1.5
title: "Security Best Practices"
tags: [CIROH, Security, Policies]
---

import useBaseUrl from '@docusaurus/useBaseUrl'

# Container Scanning Made Simple: A Guide to Trivy and Grype

<div style={{ textAlign: 'center' }}>
  <img
    src={useBaseUrl('/img/graphics/container_security.png')}
    alt="Container Security Illustration"
    style={{ width: '45%', maxWidth: '360px', margin: '1rem auto', filter: 'drop-shadow(0px 2px 6px rgba(0,0,0,0.15))' }}
  />
</div>

## Introduction: Why Should You Care About Container Security?

When you package your application into a Docker container, you're not just bundling your own code. You're also including dozens of software libraries, system tools, and dependencies. Some of these components might have security vulnerabilities that hackers could exploit to attack your application.

This is where **container scanning** comes in. It automatically checks every component in your container for known security issues before you deploy your application. Think of it as a security checkpoint that identifies weak spots in your software.

## What Are Docker Containers? (A Quick Refresher)

If you're new to Docker, think of containers as lightweight, portable boxes that contain everything your application needs to run: code, libraries, system tools, and settings. Instead of installing software directly on a computer, you package it in a container that can run consistently anywhere—on your laptop, a server, or in the cloud.

**The problem?** These containers often include outdated or vulnerable software packages that could be exploited by attackers.

## Meet Your Security Guards: Trivy and Grype

Both **Trivy** and **Grype** are free, open-source tools that scan your containers for security vulnerabilities. They work by:

1. Looking at all the software packages inside your container
2. Comparing them against databases of known vulnerabilities
3. Generating a report showing what's wrong and how serious it is

Think of them as antivirus software for your containers, but instead of scanning for viruses, they scan for security weaknesses.

## Trivy: Your All-in-One Security Scanner

**Trivy** (pronounced "trivy," short for "trivial") is developed by Aqua Security and is known for being comprehensive and easy to use.

### What Makes Trivy Special?

- **Comprehensive scanning**: Checks container images, filesystems, Git repositories, and even cloud configurations
- **Fast and accurate**: Uses multiple vulnerability databases for thorough coverage
- **Easy to install**: Works on Linux, Mac, and Windows
- **Rich output formats**: Can generate reports in JSON, tables, or even HTML

### Installing Trivy

**On Linux:**

```bash
# Using apt (Debian/Ubuntu)
sudo apt-get install wget apt-transport-https gnupg lsb-release
wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main | sudo tee -a /etc/apt/sources.list.d/trivy.list
sudo apt-get update
sudo apt-get install trivy

```

**On Mac:**

```bash
brew install trivy

```

**On Windows (using Chocolatey):**

```bash
choco install trivy

```

### Using Trivy: Practical Examples

**Scan a Docker image:**

```bash
trivy image nginx:latest

```

This command scans the official Nginx image and shows all vulnerabilities found.

**Scan only high and critical severity issues:**

```bash
trivy image --severity HIGH,CRITICAL nginx:latest

```

**Generate a JSON report:**

```bash
trivy image -f json -o results.json nginx:latest

```

**Scan your local Dockerfile before building:**

```bash
trivy config Dockerfile

```

### Understanding Trivy's Output

When you run Trivy, you'll see output like this:

```
nginx:latest (debian 11.6)
========================
Total: 145 (HIGH: 12, CRITICAL: 3)

┌──────────────┬────────────────┬──────────┬───────────────────┬───────────────┬────────────────────────────┐
│   Library    │ Vulnerability  │ Severity │ Installed Version │ Fixed Version │           Title            │
├──────────────┼────────────────┼──────────┼───────────────────┼───────────────┼────────────────────────────┤
│ openssl      │ CVE-2023-12345 │ CRITICAL │ 1.1.1n            │ 1.1.1p        │ OpenSSL Buffer Overflow    │
└──────────────┴────────────────┴──────────┴───────────────────┴───────────────┴────────────────────────────┘

```

**What this tells you:**

- **Library**: The vulnerable software package
- **Vulnerability**: The CVE (Common Vulnerabilities and Exposures) identifier
- **Severity**: How serious the issue is (LOW, MEDIUM, HIGH, CRITICAL)
- **Installed Version**: The vulnerable version you're using
- **Fixed Version**: The version you should upgrade to

## Grype: Anchore's Lightweight Scanner

**Grype** (pronounced "gripe") is developed by Anchore and focuses on speed and simplicity.

### What Makes Grype Special?

- **Lightning fast**: Optimized for speed without sacrificing accuracy
- **Multiple vulnerability databases**: Uses data from various sources including CVE databases
- **Simple CLI**: Clean, straightforward command-line interface
- **Great for CI/CD**: Easy to integrate into automated pipelines

### Installing Grype

**On Linux/Mac:**

```bash
curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin

```

**On Mac (using Homebrew):**

```bash
brew tap anchore/grype
brew install grype
```

**On Windows:**
Download the latest release from the GitHub releases page.

### Using Grype: Practical Examples

**Scan a Docker image:**

```bash
grype nginx:latest

```

**Scan with specific severity threshold:**

```bash
grype nginx:latest --fail-on high

```

This will fail (exit with error code) if any HIGH or CRITICAL vulnerabilities are found, useful for CI/CD pipelines.

**Generate a detailed JSON report:**

```bash
grype nginx:latest -o json > grype-report.json

```

**Scan a local directory:**

```bash
grype dir:/path/to/your/project

```

**Scan without updating the vulnerability database:**

```bash
grype nginx:latest --db-auto-update=false

```

### Understanding Grype's Output

Grype's output looks like this:

```
NAME          INSTALLED  FIXED-IN  TYPE  VULNERABILITY  SEVERITY
openssl       1.1.1n     1.1.1p    deb   CVE-2023-12345 Critical
curl          7.68.0     7.74.0    deb   CVE-2023-67890 High

```

The output is similar to Trivy but presented in a more compact format.

## Trivy vs. Grype: Which Should You Choose?

| Feature | Trivy | Grype |
| --- | --- | --- |
| **Speed** | Fast | Very Fast |
| **Ease of Use** | Very Easy | Very Easy |
| **Vulnerability Coverage** | Excellent | Excellent |
| **Additional Features** | Scans configs, IaC, secrets | Focused on vulnerabilities |
| **Output Formats** | Many (JSON, SARIF, HTML, etc.) | JSON, Table, CycloneDX |
| **Best For** | All-around security scanning | Fast vulnerability scanning in CI/CD |

**The honest answer?** Both are excellent. Many teams use both or choose based on specific needs:

- Choose **Trivy** if you want an all-in-one security tool that also scans configurations and secrets
- Choose **Grype** if you want blazing-fast scans focused purely on vulnerabilities

You can even use both and compare results for extra confidence!

## Integrating Scanning into Your Workflow

### Local Development

Before pushing your container image, scan it locally:

```bash
# Build your image
docker build -t myapp:latest .

# Scan with Trivy
trivy image myapp:latest

# Or scan with Grype
grype myapp:latest

```

### CI/CD Pipeline Integration

**GitHub Actions example with Trivy:**

```yaml
name: Scan Container
on: [push]

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Build image
        run: docker build -t myapp:latest .

      - name: Run Trivy scan
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: 'myapp:latest'
          severity: 'CRITICAL,HIGH'

```

**GitLab CI example with Grype:**

```yaml
scan:
  image: docker:latest
  services:
    - docker:dind
  script:
    - docker build -t myapp:latest .
    - curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin
    - grype myapp:latest --fail-on high

```

## Best Practices for Container Security

1. **Scan early and often**: Make scanning part of your build process, not an afterthought
2. **Keep base images updated**: Use the latest stable versions of base images like `node:18` instead of old versions
3. **Use minimal base images**: Consider using Alpine or distroless images with fewer packages
4. **Fix vulnerabilities before deploying**: Set policies to block deployment of images with critical vulnerabilities
5. **Regularly rescan production images**: New vulnerabilities are discovered daily, so rescan periodically

## Real-World Example: Fixing a Vulnerable Container

Let's say Trivy reports that your Node.js application container has a critical OpenSSL vulnerability:

**Step 1: Identify the issue**

```bash
trivy image myapp:latest
# Shows: openssl 1.1.1n has CVE-2023-12345 (CRITICAL)

```

**Step 2: Update your Dockerfile**

```docker
# Before
FROM node:16

# After - use a newer base image with patched OpenSSL
FROM node:18-alpine

COPY package*.json ./
RUN npm install
COPY . .
CMD ["node", "app.js"]

```

**Step 3: Rebuild and rescan**

```bash
docker build -t myapp:latest .
trivy image myapp:latest
# Verify the vulnerability is fixed
```

## Conclusion

Container scanning isn't just for security experts. Whether you're a developer, operations engineer, or someone completely new to Docker, tools like Trivy and Grype make it easy to ensure your containers are secure.

Remember: security is not a one-time task but an ongoing process. By integrating these tools into your daily workflow, you're building safer applications and protecting your users from potential threats.

Start today by scanning your first container image. You might be surprised by what you find, but that's the first step toward building more secure software.

------------------------------------------------

